<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Energy Band Gap Simulation</title>
<style>
:root {
  --primary:#4b1d7f;
  --accent:#ff9f1c;
  --green:#2ca58d;
  --blue:#118ab2;
  --yellow:#f0b429;
  --red:#d14343;
  --text:#0f1724;
  --bg:#f5f7fd;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:Poppins,Arial,sans-serif}
body{background:var(--bg);color:var(--text);height:100vh;display:flex;flex-direction:column;}
header{background:linear-gradient(90deg, #e3dfff, #f3f5ff);padding:12px 20px;display:flex;justify-content:space-between;align-items:center;border-bottom:3px solid var(--primary);}
header h1{color:var(--primary);font-size:22px;font-weight:700;}
.main-container{flex:1;display:grid;grid-template-columns:280px 1fr 150px;gap:12px;padding:12px;}
.left-panel{background:#fff;border-radius:12px;padding:15px;display:flex;flex-direction:column;gap:12px;box-shadow:0 8px 20px rgba(0,0,0,0.05);max-height:100%;overflow-y:auto;}
.left-panel h2{color:var(--primary);margin-bottom:6px;font-size:16px;}
.step-card{background:var(--primary);color:#fff;border-radius:8px;padding:10px;font-size:14px;font-weight:600;text-align:center;}
.controls{display:flex;flex-direction:column;gap:10px}
.btn{padding:10px;border:none;border-radius:10px;font-weight:600;cursor:pointer;box-shadow:0 3px 8px rgba(0,0,0,0.08);transition:0.2s}
.btn:hover{transform:translateY(-2px)}
.btn.green{background:#dff6e8;color:var(--green);}
.btn.blue{background:#d1eefb;color:var(--blue);}
.btn.yellow{background:#fff1d1;color:var(--yellow);}
.btn.red{background:#ffd6d6;color:var(--red);}
.center{background:#ffffff;border-radius:12px;padding:10px;position:relative;overflow-y:auto;overflow-x:hidden;box-shadow:0 8px 25px rgba(0,0,0,0.05);display:flex;flex-direction:column;}
.workspace{width:100%;height:500px;margin:12px auto;border-radius:6px;position:relative;overflow:hidden;}
.apparatus{position:absolute;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:6px;border-radius:12px;background:#fff;box-shadow:0 6px 18px rgba(0,0,0,0.08);min-width:80px;min-height:56px;cursor:grab;user-select:none;}
.apparatus img {max-width:200px;max-height:70px;}
.apparatus[data-name="Container"] img {max-width:250px;max-height:180px;}
.apparatus[data-name="Setup Complete"] img,
.apparatus[data-name="Experiment Complete"] img {max-width:300px;max-height:200px;}
#workspaceStatus{margin-top:6px;font-size:14px;color:#0f1724;text-align:center;}

/* connection dots */
.connector {
  position:absolute;
  width:12px;
  height:12px;
  border-radius:50%;
  border:2px solid #fff;
  box-shadow:0 0 4px rgba(0,0,0,0.3);
  cursor:pointer;
}
.connector.left {
  left:-7px; top:50%; transform:translateY(-50%);
  background:var(--red);
}
.connector.right {
  right:-7px; top:50%; transform:translateY(-50%);
  background:var(--blue);
}

/* LAB BURNER */
.lab-burner {
  width: 60px;
  height: 100px;
  background: #555;
  border-radius: 10px;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-end;
  padding-bottom: 10px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.3);
}
.lab-burner::before { content: ''; width: 10px; height: 25px; background: #333; border-radius: 2px; position: absolute; top: -25px; }
.lab-burner::after { content: ''; width: 40px; height: 10px; background: #222; border-radius: 4px; position: absolute; bottom: -10px; box-shadow: 0 3px 8px rgba(0,0,0,0.4); }
.flame { width: 20px; height: 30px; position: absolute; bottom: 70px; border-radius: 50%; background: radial-gradient(circle, #fffa65 0%, #ff9f1c 40%, #ff3f3f 80%); opacity: 0; animation: flicker 0.4s infinite; transform-origin: bottom center; box-shadow: 0 0 10px rgba(255, 100, 0, 0.7); }
@keyframes flicker {
  0% { transform: scale(1) translateY(0); opacity: 0.9; }
  25% { transform: scale(1.2,1.5) translateY(-3px); opacity: 1; }
  50% { transform: scale(0.9,1.2) translateY(-2px); opacity: 0.8; }
  75% { transform: scale(1.1,1.4) translateY(-4px); opacity: 1; }
  100% { transform: scale(1) translateY(0); opacity: 0.9; }
}
</style>
</head>
<body>
<header>
  <h1>Energy Band Gap Simulation</h1>
</header>

<div class="main-container">
  <aside class="left-panel">
    <div class="step-card" id="stepInfo">Step 1: Place container & light burner. Position diode.</div>
    <h2>Controls</h2>
    <div class="controls">
      <button class="btn blue" id="placeContainerBtn">Place Container</button>
      <button class="btn blue" id="pnBtn">P-N Diode</button>
      <button class="btn blue" id="thermoBtn">Thermometer</button>
      <button class="btn blue" id="batteryBtn">Battery</button>
      <button class="btn blue" id="ammeterBtn">Ammeter</button>
      <button class="btn blue" id="voltmeterBtn">Voltmeter</button>
      <button class="btn red" id="labBurnerBtn">Lab Burner</button>
      <button class="btn green" id="startHeatBtn">ON burner</button>
       <button class="btn blue" id="startCoolBtn">OFF burner</button>
      <button class="btn red" id="undoBtn">Undo</button>
    </div>
  </aside>

  <main class="center">

    <div class="workspace" id="workspace">
      <svg id="connections" style="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none"></svg>
    </div>
    <div id="workspaceStatus">Voltage: 5 V | Current: 0.5 A | Temperature: 25 Â°C</div>
  </main>
</div>
  

<script>
const workspace = document.getElementById("workspace");
const statusEl = document.getElementById("workspaceStatus");
const svg = document.getElementById("connections");
let appIndex = 0;
let apps = {};
let history = [];
let connections = [];
let firstConnector = null;
let temperature = 25;
let heatingInterval = null;
let coolingInterval = null;
let burnerApp = null;

const validConnections = {
  "Battery": ["Ammeter","Experiment Complete"],
  "Ammeter": ["Experiment Complete"],
  "Voltmeter": ["Experiment Complete"],
  "Experiment Complete": ["Battery","Ammeter","Voltmeter"]
};

const requiredConnectionsPolarity = [
  ["Battery", "Ammeter", "right", "left"],
  ["Ammeter", "P-N Diode", "right", "left"],
  ["P-N Diode", "Voltmeter", "right", "left"]
];



// Apparatus creation
function createApp(name,imgUrl,withDisplay=false){
  const id = `app-${++appIndex}`;
  const el = document.createElement("div");
  el.className="apparatus";
  el.dataset.id=id;
  el.dataset.name=name;

  if(withDisplay){
    const label = document.createElement("div");
    label.textContent = name;
    label.style.fontSize="12px"; label.style.fontWeight="700";
    label.style.color="var(--primary)"; label.style.marginBottom="4px"; label.style.textAlign="center";

    const box = document.createElement("div");
    box.className="display-box"; box.style.width="60px"; box.style.height="30px"; box.style.background="#f9fafb";
    box.style.border="2px solid var(--primary)"; box.style.borderRadius="6px"; box.style.display="flex";
    box.style.alignItems="center"; box.style.justifyContent="center"; box.style.fontWeight="600"; box.style.color="var(--text)";
    box.textContent = name==="Voltmeter"?"5.0":"0";

    const img = document.createElement("img"); img.src=imgUrl; img.alt=name;

    el.appendChild(label); el.appendChild(box); el.appendChild(img);
  } else {
    const img = document.createElement("img"); img.src=imgUrl; img.alt=name; el.appendChild(img);
  }

  // Add red (left) and blue (right) points
  if (["Battery", "Ammeter", "Voltmeter", "Thermometer", "Experiment Complete"].includes(name)) {
    const leftDot = document.createElement("div");
    leftDot.className = "connector left";
    const rightDot = document.createElement("div");
    rightDot.className = "connector right";
    el.appendChild(leftDot);
    el.appendChild(rightDot);

    [leftDot, rightDot].forEach(dot => dot.addEventListener("click", () => handleConnectorClick(dot)));
  }

  el.style.left = 100 + appIndex*20 + "px";
  el.style.top = 100 + appIndex*20 + "px";
  makeDraggable(el);
  workspace.appendChild(el);
  apps[id]=el; history.push({type:"add",id,el});
  return el;
}

/* Draggable logic */
function makeDraggable(el) {
  let offsetX, offsetY, isDown = false;
  el.addEventListener("mousedown", (e) => {
    if (e.target.classList.contains("connector")) return; // avoid drag from connector
    isDown = true;
    const rect = el.getBoundingClientRect();
    offsetX = e.clientX - rect.left;
    offsetY = e.clientY - rect.top;
    el.style.zIndex = 1000;
  });
  window.addEventListener("mousemove", (e) => {
    if (!isDown) return;
    const wsRect = workspace.getBoundingClientRect();
    el.style.left = e.clientX - wsRect.left - offsetX + "px";
    el.style.top  = e.clientY - wsRect.top - offsetY + "px";
    updateLines();
  });
  window.addEventListener("mouseup",()=>{
    if(isDown) checkMerge(el);
    isDown=false;
    el.style.zIndex=1;
  });
}

function isOverlapping(el1,el2){
  const r1=el1.getBoundingClientRect(),r2=el2.getBoundingClientRect();
  return !(r1.top>r2.bottom||r1.bottom<r2.top||r1.left>r2.right||r1.right<r2.left);
}

function checkMerge(el){
  Object.values(apps).forEach(other=>{
    if(other===el) return;
    const n1=el.dataset.name,n2=other.dataset.name;
    if((n1==="Container"&&n2==="P-N Diode")||(n1==="P-N Diode"&&n2==="Container"))
      mergeApps(el,other,"Setup Complete","images/pic1.png");
    if((n1==="Setup Complete"&&n2==="Thermometer")||(n1==="Thermometer"&&n2==="Setup Complete"))
      mergeApps(el,other,"Experiment Complete","images/therinbeak.png");
  });
}

function mergeApps(el1,el2,newName,newImg){
  workspace.removeChild(el1); workspace.removeChild(el2);
  delete apps[el1.dataset.id]; delete apps[el2.dataset.id];
  createApp(newName,newImg);
  statusEl.textContent=`${newName} created!`; statusEl.style.color="green";
}

/* --- Wire System --- */
let firstConnector=null, connections=[];
function handleConnectorClick(dot){
  if(!firstConnector){firstConnector=dot;dot.style.outline="2px solid gold";}
  else if(firstConnector!==dot){
    drawConnection(firstConnector,dot);
    firstConnector.style.outline="none";
    firstConnector=null;
  }else{
    firstConnector.style.outline="none";
    firstConnector=null;
  }
}
function getCenter(el){
  const r=el.getBoundingClientRect(),ws=workspace.getBoundingClientRect();
  return {x:r.left-ws.left+r.width/2,y:r.top-ws.top+r.height/2};
}
function drawConnection(d1,d2){
  const p1=getCenter(d1),p2=getCenter(d2);
  const line=document.createElementNS("http://www.w3.org/2000/svg","line");
  line.setAttribute("x1",p1.x);
  line.setAttribute("y1",p1.y);
  line.setAttribute("x2",p2.x);
  line.setAttribute("y2",p2.y);
  line.setAttribute("stroke","black");
  line.setAttribute("stroke-width","2");
  svg.appendChild(line);
  connections.push({line,dot1:d1,dot2:d2});
}
function updateLines(){
  connections.forEach(c=>{
    const p1=getCenter(c.dot1),p2=getCenter(c.dot2);
    c.line.setAttribute("x1",p1.x);
    c.line.setAttribute("y1",p1.y);
    c.line.setAttribute("x2",p2.x);
    c.line.setAttribute("y2",p2.y);
  });
}

/* Undo last */
function undoLast(){
  const last=history.pop();if(!last)return;
  if(last.type==="add"){const el=apps[last.id];if(el)workspace.removeChild(el);delete apps[last.id];}
}

// Buttons
document.getElementById("placeContainerBtn").addEventListener("click",()=>createApp("Container","images/PIC0.png"));
document.getElementById("pnBtn").addEventListener("click",()=>createApp("P-N Diode","https://flaviocopes.com/images/electronics-components-diodes/Screen_Shot_2020-12-06_at_11.54.39.png"));
document.getElementById("batteryBtn").addEventListener("click",()=>createApp("Battery","images/battery.png"));
document.getElementById("ammeterBtn").addEventListener("click",()=>createApp("Ammeter","images/ammeter.png",true));
document.getElementById("voltmeterBtn").addEventListener("click",()=>createApp("Voltmeter","images/voltmeter.png",true));
document.getElementById("thermoBtn").addEventListener("click",()=>createApp("Thermometer","images/thermo.png"));
document.getElementById("undoBtn").addEventListener("click",undoLast);
</script>

</body>
</html>
