<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Energy Band Gap Simulation</title>
<style>
:root {
  --primary:#4b1d7f;
  --accent:#ff9f1c;
  --green:#2ca58d;
  --blue:#118ab2;
  --yellow:#f0b429;
  --red:#d14343;
  --text:#0f1724;
  --bg:#f5f7fd;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:Poppins,Arial,sans-serif}
body{background:var(--bg);color:var(--text);height:100vh;display:flex;flex-direction:column;}
header{background:linear-gradient(90deg, #e3dfff, #f3f5ff);padding:12px 20px;display:flex;justify-content:space-between;align-items:center;border-bottom:3px solid var(--primary);}
header h1{color:var(--primary);font-size:22px;font-weight:700;}
.main-container{flex:1;display:grid;grid-template-columns:280px 1fr 150px;gap:12px;padding:12px;}
.left-panel{background:#fff;border-radius:12px;padding:15px;display:flex;flex-direction:column;gap:12px;box-shadow:0 8px 20px rgba(0,0,0,0.05);max-height:100%;overflow-y:auto;}
.left-panel h2{color:var(--primary);margin-bottom:6px;font-size:16px;}
.step-card{background:var(--primary);color:#fff;border-radius:8px;padding:10px;font-size:14px;font-weight:600;text-align:center;}
.controls{display:flex;flex-direction:column;gap:10px}
.btn{padding:10px;border:none;border-radius:10px;font-weight:600;cursor:pointer;box-shadow:0 3px 8px rgba(0,0,0,0.08);transition:0.2s}
.btn:hover{transform:translateY(-2px)}
.btn.green{background:#dff6e8;color:var(--green);}
.btn.blue{background:#d1eefb;color:var(--blue);}
.btn.yellow{background:#fff1d1;color:var(--yellow);}
.btn.red{background:#ffd6d6;color:var(--red);}
.center{background:#ffffff;border-radius:12px;padding:10px;position:relative;overflow-y:auto;overflow-x:hidden;box-shadow:0 8px 25px rgba(0,0,0,0.05);display:flex;flex-direction:column;}
.workspace{width:100%;height:500px;margin:12px auto;border-radius:6px;position:relative;overflow:hidden;}
.apparatus{position:absolute;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:6px;border-radius:12px;background:#fff;box-shadow:0 6px 18px rgba(0,0,0,0.08);min-width:80px;min-height:56px;cursor:grab;user-select:none;}
.apparatus img {max-width:200px;max-height:70px;}
.apparatus[data-name="Container"] img {max-width:250px;max-height:180px;}
.apparatus[data-name="Setup Complete"] img,
.apparatus[data-name="Experiment Complete"] img {max-width:300px;max-height:200px;}
#workspaceStatus{margin-top:6px;font-size:14px;color:#0f1724;text-align:center;}

/* connection dots */
.connector {
  position:absolute;
  width:12px;
  height:12px;
  border-radius:50%;
  border:2px solid #fff;
  box-shadow:0 0 4px rgba(0,0,0,0.3);
  cursor:pointer;
}
.connector.left {
  left:-7px; top:50%; transform:translateY(-50%);
  background:var(--red);
}
.connector.right {
  right:-7px; top:50%; transform:translateY(-50%);
  background:var(--blue);
}

/* LAB BURNER */
.lab-burner {
  width: 60px;
  height: 100px;
  background: #555;
  border-radius: 10px;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-end;
  padding-bottom: 10px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.3);
}
.lab-burner::before { content: ''; width: 10px; height: 25px; background: #333; border-radius: 2px; position: absolute; top: -25px; }
.lab-burner::after { content: ''; width: 40px; height: 10px; background: #222; border-radius: 4px; position: absolute; bottom: -10px; box-shadow: 0 3px 8px rgba(0,0,0,0.4); }
.flame { width: 20px; height: 30px; position: absolute; bottom: 70px; border-radius: 50%; background: radial-gradient(circle, #fffa65 0%, #ff9f1c 40%, #ff3f3f 80%); opacity: 0; animation: flicker 0.4s infinite; transform-origin: bottom center; box-shadow: 0 0 10px rgba(255, 100, 0, 0.7); }
@keyframes flicker {
  0% { transform: scale(1) translateY(0); opacity: 0.9; }
  25% { transform: scale(1.2,1.5) translateY(-3px); opacity: 1; }
  50% { transform: scale(0.9,1.2) translateY(-2px); opacity: 0.8; }
  75% { transform: scale(1.1,1.4) translateY(-4px); opacity: 1; }
  100% { transform: scale(1) translateY(0); opacity: 0.9; }
}
</style>
</head>
<body>
<header>
  <h1>Energy Band Gap Simulation</h1>
</header>

<div class="main-container">
  <aside class="left-panel">
    <div class="step-card" id="stepInfo">Step 1: Place container & light burner. Position diode.</div>
    <h2>Controls</h2>
    <div class="controls">
      <button class="btn blue" id="placeContainerBtn">Place Container</button>
      <button class="btn blue" id="pnBtn">P-N Diode</button>
      <button class="btn blue" id="thermoBtn">Thermometer</button>
      <button class="btn blue" id="batteryBtn">Battery</button>
      <button class="btn blue" id="ammeterBtn">Ammeter</button>
      <button class="btn blue" id="voltmeterBtn">Voltmeter</button>
      <button class="btn red" id="labBurnerBtn">Lab Burner</button>
      <button class="btn green" id="startHeatBtn">ON burner</button>
      <button class="btn blue" id="startCoolBtn">OFF burner</button>
      <button class="btn red" id="undoBtn">Undo</button>
      <button class="btn yellow" id="resetWiresBtn">Undo Wires</button>
    </div>
  </aside>

  <main class="center">
    <div class="workspace" id="workspace">
      <svg id="connections" style="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none"></svg>
    </div>
    <div id="workspaceStatus">Voltage: 5 V | Current: 0.5 A | Temperature: 25 °C | Resistance: 10 Ω</div>
  </main>
</div>

<script>
// ---------------------------
// Backend Integration JS
// ---------------------------
const statusEl = document.getElementById("workspaceStatus");

// Fetch dynamic readings every 2 seconds
async function updateReadings() {
    try {
        const res = await fetch('/api/readings');
        const data = await res.json();
        statusEl.textContent = `Voltage: ${data.voltage} V | Current: ${data.current} A | Temperature: ${data.temperature} °C | Resistance: ${data.resistance} Ω`;
    } catch(err) {
        console.error("Error fetching readings:", err);
    }
}
setInterval(updateReadings, 2000);

// Calculate resistance manually
async function calculateResistance(voltage, current) {
    try {
        const res = await fetch('/api/calculate', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({voltage, current})
        });
        const data = await res.json();
        alert(`Resistance: ${data.resistance} Ω`);
    } catch(err) {
        console.error(err);
    }
}

// Example: Plot graph
async function plotGraph() {
    try {
        const temperature = [25, 40, 60, 80, 100];
        const voltage = [5, 5.5, 6, 6.3, 6.5];
        const res = await fetch('/api/plot', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({temperature, voltage})
        });
        const data = await res.json();
        const img = document.createElement('img');
        img.src = data.graph_url;
        img.style.width = '400px';
        img.style.marginTop = '10px';
        document.body.appendChild(img);
    } catch(err) {
        console.error(err);
    }
}

// Optional: Bind to a button for testing
const testGraphBtn = document.createElement('button');
testGraphBtn.className = 'btn green';
testGraphBtn.textContent = 'Show Graph';
testGraphBtn.addEventListener('click', plotGraph);
document.querySelector('.left-panel .controls').appendChild(testGraphBtn);

<<<<<<< HEAD
=======
function checkMerge(el){
  Object.values(apps).forEach(other=>{
    if(other===el) return;
    const n1=el.dataset.name,n2=other.dataset.name;
    if((n1==="Container"&&n2==="P-N Diode")||(n1==="P-N Diode"&&n2==="Container"))
      mergeApps(el,other,"Setup Complete","images/pic1.png");
    if((n1==="Setup Complete"&&n2==="Thermometer")||(n1==="Thermometer"&&n2==="Setup Complete"))
      mergeApps(el,other,"Experiment Complete","images/therinbeak.png");
  });
}

function mergeApps(el1,el2,newName,newImg){
  workspace.removeChild(el1); workspace.removeChild(el2);
  delete apps[el1.dataset.id]; delete apps[el2.dataset.id];
  createApp(newName,newImg);
  statusEl.textContent=`${newName} created!`; statusEl.style.color="green";
}

/* --- Flexible Wire System --- */
let activePath = null;
let pathPoints = [];
let startConnector = null;

function getConnectorPos(dot){
  const r = dot.getBoundingClientRect(), ws = workspace.getBoundingClientRect();
  return {x: r.left - ws.left + r.width/2, y: r.top - ws.top + r.height/2};
}

function handleConnectorClick(e){
  if(e.button!==0) return;
  const dot = e.target;
  if(!activePath){
    startConnector = dot;
    pathPoints = [getConnectorPos(dot)];
    activePath = document.createElementNS("http://www.w3.org/2000/svg","polyline");
    activePath.setAttribute("fill","none");
    activePath.setAttribute("stroke","black");
    activePath.setAttribute("stroke-width","2");
    svg.appendChild(activePath);
    window.addEventListener("mousemove", followCursor);
    workspace.addEventListener("mousedown", addBend);
  } else if(dot!==startConnector){
    pathPoints.push(getConnectorPos(dot));
    updateActivePath(getConnectorPos(dot));
    connections.push({line: activePath, dot1: startConnector, dot2: dot, bends: [...pathPoints]});
    activePath = null; pathPoints=[]; startConnector=null;
    window.removeEventListener("mousemove", followCursor);
    workspace.removeEventListener("mousedown", addBend);
  }
}

function followCursor(e){
  const wsRect = workspace.getBoundingClientRect();
  updateActivePath({x:e.clientX - wsRect.left, y:e.clientY - wsRect.top});
}

function addBend(e){
  if(e.button!==0 || !activePath) return;
  const wsRect = workspace.getBoundingClientRect();
  const pos = {x:e.clientX - wsRect.left, y:e.clientY - wsRect.top};
  const last = pathPoints[pathPoints.length-1];
  pathPoints.push({x: pos.x, y:last.y});
  pathPoints.push(pos);
  updateActivePath(pos);
}

function updateActivePath(cursorPos){
  if(!activePath) return;
  const pts = [...pathPoints,cursorPos].map(p=>`${p.x},${p.y}`).join(" ");
  activePath.setAttribute("points",pts);
}

function updateLines(){
  connections.forEach(c=>{
    const p1 = getConnectorPos(c.dot1), p2 = getConnectorPos(c.dot2);
    const bends = [p1,...c.bends.slice(1,-1),p2];
    c.line.setAttribute("points", bends.map(p=>`${p.x},${p.y}`).join(" "));
  });
}

// Undo last
function undoLast(){ const last=history.pop(); if(!last) return; if(last.type==="add"){ const el=apps[last.id]; if(el) workspace.removeChild(el); delete apps[last.id]; } }

// Buttons
document.getElementById("placeContainerBtn").addEventListener("click",()=>createApp("Container","images/PIC0.png"));
document.getElementById("pnBtn").addEventListener("click",()=>createApp("P-N Diode","https://flaviocopes.com/images/electronics-components-diodes/Screen_Shot_2020-12-06_at_11.54.39.png"));
document.getElementById("batteryBtn").addEventListener("click",()=>createApp("Battery","images/battery.png"));
document.getElementById("ammeterBtn").addEventListener("click",()=>createApp("Ammeter","images/ammeter.png",true));
document.getElementById("voltmeterBtn").addEventListener("click",()=>createApp("Voltmeter","images/voltmeter.png",true));
document.getElementById("thermoBtn").addEventListener("click",()=>createApp("Thermometer","images/thermo.png"));
document.getElementById("undoBtn").addEventListener("click",undoLast);
document.getElementById("resetWiresBtn").addEventListener("click", () => {
  if(connections.length===0){ statusEl.textContent="No wires to remove!"; statusEl.style.color="red"; return; }
  const lastConn = connections.pop();
  svg.removeChild(lastConn.line);
  statusEl.textContent=`Removed connection between ${lastConn.dot1.parentElement.dataset.name} → ${lastConn.dot2.parentElement.dataset.name}`;
  statusEl.style.color="orange";
});

// Lab Burner
document.getElementById("labBurnerBtn").addEventListener("click", () => {
  if(!burnerApp){
    const id = `app-${++appIndex}`;
    const el = document.createElement("div"); el.className="apparatus lab-burner"; el.dataset.id=id; el.dataset.name="Lab Burner";
    const flame = document.createElement("div"); flame.className="flame"; el.appendChild(flame); el.flame=flame;
    el.style.left = 150 + appIndex*20 + "px"; el.style.top = 150 + appIndex*20 + "px";
    makeDraggable(el); workspace.appendChild(el); apps[id]=el; history.push({type:"add",id,el}); burnerApp=el;
    statusEl.textContent="Lab Burner placed!"; statusEl.style.color="green";
  }
});

// Heating / Cooling (no wire check)
function startHeating() {
    clearInterval(coolingInterval);
    if (burnerApp) burnerApp.flame.style.display = "block";
    heatingInterval = setInterval(() => {
        if (temperature < 100) {
            temperature += 5;
            statusEl.textContent = `Heating... Temperature: ${temperature} °C`;
        } else {
            clearInterval(heatingInterval);
            statusEl.textContent = "Maximum temperature reached: 100°C";
        }
    }, 1000);
}

function startCooling() {
    clearInterval(heatingInterval);
    if (burnerApp) burnerApp.flame.style.display = "none";
    coolingInterval = setInterval(() => {
        if (temperature > 25) {
            temperature -= 5;
            statusEl.textContent = `Cooling... Temperature: ${temperature} °C`;
        } else {
            clearInterval(coolingInterval);
            statusEl.textContent = "Room temperature reached: 25°C";
        }
    }, 1000);
}

document.getElementById("startHeatBtn").addEventListener("click", startHeating);
document.getElementById("startCoolBtn").addEventListener("click", startCooling);


// --- Steps System ---
const steps = [
  "Step 1: Place beaker and then insert diode by dragging the image on beaker",
  "Step 2: now insert the thermometer by dragging it in the beaker",
  "Step 3: now fix voltmeter , ammeter and battery",
  "Step 4: connect positve terminal (red) of voltmeter and ammeter",
  "Step 5: connect negative terminal (blue) of ammeter to negative terminal (blue) of diode ",
  "Step 6: connect negative terminal (blue) of battery to positive terminal (red) of diode",
  "Step 7: connect negative terminal (blue) of volmeter to positive terminal (red) of battery",
  "Step 8: put a burner below beaker and turn on the burner ",
  "Step 9: now we will take reading of heating and cooling"

];


let currentStep = 0;

const rightPanel = document.createElement("aside");
rightPanel.style = "background:#fff;border-radius:12px;padding:15px;display:flex;flex-direction:column;gap:10px;box-shadow:0 8px 20px rgba(0,0,0,0.05);max-height:100%;overflow-y:auto;align-items:center;justify-content:center;";

const backStepBtn = document.createElement("button");
backStepBtn.className = "btn yellow";
backStepBtn.textContent = "Back Step";

const nextStepBtn = document.createElement("button");
nextStepBtn.className = "btn yellow";
nextStepBtn.textContent = "Next Step";

const showGraphBtn = document.createElement("button");
showGraphBtn.className = "btn green";
showGraphBtn.textContent = "Show Readings / Graphs";
showGraphBtn.addEventListener("click", () => {
  window.location.href = "readings_graphs.html";
});

rightPanel.appendChild(backStepBtn);
rightPanel.appendChild(nextStepBtn);
rightPanel.appendChild(showGraphBtn);
document.querySelector(".main-container").appendChild(rightPanel);

// step update
const stepLeftInfo = document.getElementById("stepInfo");
function updateStep(stepIndex){
  stepLeftInfo.textContent = steps[stepIndex];
  document.getElementById("workspaceStatus").textContent = `Now: ${steps[stepIndex]}`;
}
nextStepBtn.addEventListener("click",()=>{ if(currentStep<steps.length-1){currentStep++;updateStep(currentStep);} });
backStepBtn.addEventListener("click",()=>{ if(currentStep>0){currentStep--;updateStep(currentStep);} });

>>>>>>> origin/main
</script>
</body>
</html>
