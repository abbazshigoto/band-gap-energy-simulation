<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Energy Band Gap Simulation</title>
<style>
:root {
  --primary:#4b1d7f;
  --accent:#ff9f1c;
  --green:#2ca58d;
  --blue:#118ab2;
  --yellow:#f0b429;
  --red:#d14343;
  --text:#0f1724;
  --bg:#f5f7fd;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:Poppins,Arial,sans-serif}
body{background:var(--bg);color:var(--text);height:100vh;display:flex;flex-direction:column;}
header{background:linear-gradient(90deg, #e3dfff, #f3f5ff);padding:12px 20px;display:flex;justify-content:space-between;align-items:center;border-bottom:3px solid var(--primary);}
header h1{color:var(--primary);font-size:22px;font-weight:700;}
.main-container{flex:1;display:grid;grid-template-columns:280px 1fr 150px;gap:12px;padding:12px;}
.left-panel{background:#fff;border-radius:12px;padding:15px;display:flex;flex-direction:column;gap:12px;box-shadow:0 8px 20px rgba(0,0,0,0.05);max-height:100%;overflow-y:auto;}
.left-panel h2{color:var(--primary);margin-bottom:6px;font-size:16px;}
.step-card{background:var(--primary);color:#fff;border-radius:8px;padding:10px;font-size:14px;font-weight:600;text-align:center;}
.controls{display:flex;flex-direction:column;gap:10px}
.btn{padding:10px;border:none;border-radius:10px;font-weight:600;cursor:pointer;box-shadow:0 3px 8px rgba(0,0,0,0.08);transition:0.2s}
.btn:hover{transform:translateY(-2px)}
.btn.green{background:#dff6e8;color:var(--green);}
.btn.blue{background:#d1eefb;color:var(--blue);}
.btn.yellow{background:#fff1d1;color:var(--yellow);}
.btn.red{background:#ffd6d6;color:var(--red);}
.center{background:#ffffff;border-radius:12px;padding:10px;position:relative;overflow-y:auto;overflow-x:hidden;box-shadow:0 8px 25px rgba(0,0,0,0.05);display:flex;flex-direction:column;}
.workspace{width:100%;height:500px;margin:12px auto;border-radius:6px;position:relative;overflow:hidden;}
.apparatus{position:absolute;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:6px;padding:6px;border-radius:12px;background:#fff;box-shadow:0 6px 18px rgba(0,0,0,0.08);min-width:80px;min-height:56px;cursor:grab;user-select:none;}
.apparatus img {max-width:200px;max-height:70px;}
.apparatus[data-name="Container"] img {max-width:250px;max-height:180px;}
.apparatus[data-name="Setup Complete"] img,
.apparatus[data-name="Experiment Complete"] img {max-width:300px;max-height:200px;}
#workspaceStatus{margin-top:6px;font-size:14px;color:#0f1724;text-align:center;}

/* connection dots */
.connector {
  position:absolute;
  width:12px;
  height:12px;
  border-radius:50%;
  border:2px solid #fff;
  box-shadow:0 0 4px rgba(0,0,0,0.3);
  cursor:pointer;
}
.connector.left {
  left:-7px; top:50%; transform:translateY(-50%);
  background:var(--red);
}
.connector.right {
  right:-7px; top:50%; transform:translateY(-50%);
  background:var(--blue);
}

/* LAB BURNER */
.lab-burner {
  width: 60px;
  height: 100px;
  background: #555;
  border-radius: 10px;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-end;
  padding-bottom: 10px;
  box-shadow: 0 6px 15px rgba(0,0,0,0.3);
}
.lab-burner::before { content: ''; width: 10px; height: 25px; background: #333; border-radius: 2px; position: absolute; top: -25px; }
.lab-burner::after { content: ''; width: 40px; height: 10px; background: #222; border-radius: 4px; position: absolute; bottom: -10px; box-shadow: 0 3px 8px rgba(0,0,0,0.4); }
.flame { width: 20px; height: 30px; position: absolute; bottom: 70px; border-radius: 50%; background: radial-gradient(circle, #fffa65 0%, #ff9f1c 40%, #ff3f3f 80%); opacity: 0; animation: flicker 0.4s infinite; transform-origin: bottom center; box-shadow: 0 0 10px rgba(255, 100, 0, 0.7); }
@keyframes flicker {
  0% { transform: scale(1) translateY(0); opacity: 0.9; }
  25% { transform: scale(1.2,1.5) translateY(-3px); opacity: 1; }
  50% { transform: scale(0.9,1.2) translateY(-2px); opacity: 0.8; }
  75% { transform: scale(1.1,1.4) translateY(-4px); opacity: 1; }
  100% { transform: scale(1) translateY(0); opacity: 0.9; }
}
</style>
</head>
<body>
<header>
  <h1>Energy Band Gap Simulation</h1>
</header>

<div class="main-container">
  <aside class="left-panel">
    <div class="step-card" id="stepInfo">Step 1: Place container & light burner. Position diode.</div>
    <h2>Controls</h2>
    <div class="controls">
      <button class="btn blue" id="placeContainerBtn">Place Container</button>
      <button class="btn blue" id="pnBtn">P-N Diode</button>
      <button class="btn blue" id="thermoBtn">Thermometer</button>
      <button class="btn blue" id="batteryBtn">Battery</button>
      <button class="btn blue" id="ammeterBtn">Ammeter</button>
      <button class="btn blue" id="voltmeterBtn">Voltmeter</button>
      <button class="btn red" id="labBurnerBtn">Lab Burner</button>
      <button class="btn green" id="startHeatBtn">ON burner</button>
      <button class="btn blue" id="startCoolBtn">OFF burner</button>
      <button class="btn red" id="undoBtn">Undo</button>
      <button class="btn yellow" id="resetWiresBtn">Undo Wires</button>
    </div>
  </aside>

  <main class="center">
    <div class="workspace" id="workspace">
      <svg id="connections" style="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none"></svg>
    </div>
    <div id="workspaceStatus">Voltage: 5 V | Current: 0.5 A | Temperature: 25 °C | Resistance: 10 Ω</div>
  </main>
</div>

<script>
// ---------------------------
// Backend Integration JS
// ---------------------------
const statusEl = document.getElementById("workspaceStatus");

// Fetch dynamic readings every 2 seconds
async function updateReadings() {
    try {
        const res = await fetch('/api/readings');
        const data = await res.json();
        statusEl.textContent = `Voltage: ${data.voltage} V | Current: ${data.current} A | Temperature: ${data.temperature} °C | Resistance: ${data.resistance} Ω`;
    } catch(err) {
        console.error("Error fetching readings:", err);
    }
}
setInterval(updateReadings, 2000);

// Calculate resistance manually
async function calculateResistance(voltage, current) {
    try {
        const res = await fetch('/api/calculate', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({voltage, current})
        });
        const data = await res.json();
        alert(`Resistance: ${data.resistance} Ω`);
    } catch(err) {
        console.error(err);
    }
}

// Example: Plot graph
async function plotGraph() {
    try {
        const temperature = [25, 40, 60, 80, 100];
        const voltage = [5, 5.5, 6, 6.3, 6.5];
        const res = await fetch('/api/plot', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({temperature, voltage})
        });
        const data = await res.json();
        const img = document.createElement('img');
        img.src = data.graph_url;
        img.style.width = '400px';
        img.style.marginTop = '10px';
        document.body.appendChild(img);
    } catch(err) {
        console.error(err);
    }
}

// Optional: Bind to a button for testing
const testGraphBtn = document.createElement('button');
testGraphBtn.className = 'btn green';
testGraphBtn.textContent = 'Show Graph';
testGraphBtn.addEventListener('click', plotGraph);
document.querySelector('.left-panel .controls').appendChild(testGraphBtn);

</script>
</body>
</html>
